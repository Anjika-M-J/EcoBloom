{% extends 'User/Head.html' %}

{% block content %}


<style>
    /* Page Title */
    h2 {
        text-align: center;
        margin: 20px 0;
        font-size: 28px;
        font-weight: 600;
        color: #2e7d32;
        letter-spacing: 1px;
    }

    /* Table Styling */
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        font-family: 'Segoe UI', sans-serif;
        background: #ffffff;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
        border: none;
    }

    table th {
        background: linear-gradient(45deg, #2e7d32, #43a047);
        color: white;
        padding: 14px;
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border: none;
    }

    table td {
        padding: 14px;
        text-align: center;
        font-size: 14px;
        color: #444;
        border-bottom: 1px solid #f0f0f0;
    }

    table tr:hover {
        background-color: #f4fbf4;
        transition: 0.3s ease;
    }

    table tr:last-child td {
        border-bottom: none;
    }

    /* Worker Image */
    table img {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid #43a047;
        transition: 0.3s;
    }

    table img:hover {
        transform: scale(1.05);
    }

    /* Responsive */
    @media screen and (max-width: 768px) {
        table th, table td {
            padding: 8px;
            font-size: 12px;
        }

        table img {
            width: 60px;
            height: 60px;
        }
    }
</style>


<h2>Ward Workers</h2>

<table border="1" width="100%">
    <tr>
        <th>SL NO</th>
        <th>Photo</th>
        <th>Name</th>
        <th>Contact</th>
        <th>City</th>
    </tr>
    {% for i in data %}
    <tr>
        <td>{{ forloop.counter }}</td>
        <td>
            <img src="{{ i.worker_photo.url }}" width="100px">
        </td>
        <td>{{ i.worker_name }}</td>
        <td>{{ i.worker_contact }}</td>
        <td>{{ i.worker_curr_city }}</td>
    </tr>
    {% endfor %}
</table>

<br>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
<script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>

<!-- Map -->
<div id="map" style="height: 400px; width: 100%;"></div>

<!-- Leaflet CSS -->
<link rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<!-- MarkerCluster CSS -->
<link rel="stylesheet"
      href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css"/>
<link rel="stylesheet"
      href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css"/>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- MarkerCluster JS (AFTER Leaflet JS) -->
<script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>


<!-- Worker Data -->
<script>
    const workers = [
        {% for i in data %}
        {
            name: "{{ i.worker_name }}",
            lat: {{ i.worker_latitude|default:"null" }},
            lng: {{ i.worker_longitude|default:"null" }},
            city: "{{ i.worker_curr_city }}"
        }{% if not forloop.last %},{% endif %}
        {% endfor %}
    ];
</script>


<script>
    // Initialize map
    const map = L.map('map').setView([10.8505, 76.2711], 7);

    // Tile layer
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: 'Â© OpenStreetMap'
    }).addTo(map);

    // ðŸ”¥ Create marker cluster group
    const markerCluster = L.markerClusterGroup();

    const bounds = [];

    workers.forEach(worker => {
        const lat = parseFloat(worker.lat);
        const lng = parseFloat(worker.lng);

        if (!isNaN(lat) && !isNaN(lng)) {

            const marker = L.marker([lat, lng])
                .bindPopup(
                    `<b>${worker.name}</b><br>${worker.city}`
                );

            // âœ… Add marker to cluster
            markerCluster.addLayer(marker);

            bounds.push([lat, lng]);
        }
    });

    // âœ… Add cluster group to map
    map.addLayer(markerCluster);

    // Auto zoom handling
    if (bounds.length === 1) {
        map.setView(bounds[0], 15);
    } 
    else if (bounds.length > 1) {
        map.fitBounds(bounds, { padding: [40, 40] });
    } 
    else {
        map.setView([10.8505, 76.2711], 7);
    }
</script>




{% endblock content %}
